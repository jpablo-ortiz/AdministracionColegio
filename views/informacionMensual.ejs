<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gráficos</title>
    <script src="https://kit.fontawesome.com/c9d22b43b9.js" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="/css/buttons.css">
    <link rel ="stylesheet" href="/css/SelectBoxes.css">
    <link rel="stylesheet" href="/css/Estadismensual.css">
  

   
</head>
<body>

<div class="navegacion">
  <%- include('partials/navegacion') %>
    </div>
    
    <div class="login">
    <div class="container">
      <div class="row">
        <div class="col-md-12 text-center">
          <h3 class="animate-charcter"> Estadísticas Mensuales</h3>
      <div class ="login-form">
    
    <h2> Selecciona la zona que quieres visualizar</h2>
  
    
 
    <div id="optionsMes">
      <select  name="mes" id="mes">
        <option value="nulo"> Seleciona un mes </option>
        <option value="Enero">Enero</option>
        <option value="Febrero">Febrero </option>
        <option value="Marzo">Marzo</option>
        <option value="Abril"> Abril</option>
        <option value="Mayo"> Mayo</option>
        <option value="Junio"> Junio</option>
        <option value="Julio"> Julio</option>
        <option value="Agosto"> Agosto</option>
        <option value="Septiembre"> Septiembre</option>
        <option value="Octubre"> Octubre</option>
        <option value="Noviembre"> Noviembre</option>
        <option value="Diciembre"> Diciembre</option>
      </select>
    </div>
   
    <h2 id="subtitulo"></h2>
   
    <% if (locals.datos) { %>
      <div class="login">
        <canvas id="barra"> </canvas>
        
          </div>
         
           <% var datosCanvas = [] %>
           <% for( let index = 0; index < datos.length; index++ ) { %>
                <% let obj = { nombre : datos[index].nombre, sede : datos[index].sede, zona: datos[index].zona, control: datos[index].tipoControl, mes: datos[index].mes, ano: datos[index].ano} %>
                <% datosCanvas.push(obj) %>
                
           
           <% } %>
          </div>
          
          </div>
          <div id="divTablaH"></div>
          
        </div>
        </div>
      </div>
      
    <% }else{ %>
        <h2> No hay datos </h1>
        <% } %>
        
        <div id="mydiv" data-test=<%= datosCanvas %>></div> 
        <!-- <p id="prueba"></p> -->
     
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let grafico;
       
        let datosEmpleados = <%- JSON.stringify(datosCanvas) %>;
        let datosMes;
        
       

        let datosZona = ["Seleciona una Zona", "Recepción", "Preescolar", "ZonasComunesPre", "Básicas"];
        //Primero vamos a hacer una condición de acuerdo al mes que se seleccione 
        let mes = document.getElementById("mes");
        let valorMes;
        let divPrincipal = document.getElementById("optionsMes");
        let div = document.createElement("div");
        div.id = "optionsContainer";
        divPrincipal.appendChild(div);
      
        mes.addEventListener('change', (event)=>{
          valorMes = event.target.value;
          if (valorMes == "nulo") {
            
            if (grafico) {
              grafico.destroy();
            }
           }
           else if (valorMes == "Enero"){
            div.innerHTML = "";
           
            datosMes = datosEmpleados.filter((dato) => dato.mes == "Enero");
         
            crearElementosOption(datosZona, "zona" ,divPrincipal, div);
            let zona = document.getElementById("zona");
            recorrerZonas(datosMes, zona);
           }
           else if (valorMes == "Febrero"){
            div.innerHTML = "";
           
            datosMes = datosEmpleados.filter((dato) => dato.mes == "Febrero");
            console.log(datosMes)
            crearElementosOption(datosZona, "zona" ,divPrincipal, div);
            let zona = document.getElementById("zona");
            recorrerZonas(datosMes, zona);
           }
           else if (valorMes == "Marzo"){
            div.innerHTML = "";
            datosMes = datosEmpleados.filter((dato) => dato.mes == "Marzo");
            console.log(datosMes)
            crearElementosOption(datosZona, "zona" ,divPrincipal, div);
            let zona = document.getElementById("zona");
            recorrerZonas(datosMes, zona);

           }
           else if ( valorMes == "Abril"){
            div.innerHTML = "";
            datosMes = datosEmpleados.filter((dato) => dato.mes == "Abril");
           
            crearElementosOption(datosZona, "zona" ,divPrincipal, div);
            let zona = document.getElementById("zona");
            recorrerZonas(datosMes, zona);
           }
           else if (valorMes == "Mayo"){
            div.innerHTML = "";
            datosMes = datosEmpleados.filter((dato) => dato.mes == "Mayo");
            console.log(datosMes)
            crearElementosOption(datosZona, "zona" ,divPrincipal, div);
            let zona = document.getElementById("zona");
            recorrerZonas(datosMes, zona);
           }
           else if (valorMes == "Junio"){
            div.innerHTML = "";
            datosMes = datosEmpleados.filter((dato) => dato.mes == "Junio");
            console.log(datosMes)
            crearElementosOption(datosZona, "zona" ,divPrincipal, div);
            let zona = document.getElementById("zona");
            recorrerZonas(datosMes, zona);
           }
           else if (valorMes == "Julio"){
            div.innerHTML = "";
            datosMes = datosEmpleados.filter((dato) => dato.mes == "Julio");
            console.log(datosMes)
            crearElementosOption(datosZona, "zona" ,divPrincipal, div);
            let zona = document.getElementById("zona");
            recorrerZonas(datosMes, zona);
           }
           else if (valorMes == "Agosto"){
            div.innerHTML = "";
            datosMes = datosEmpleados.filter((dato) => dato.mes == "Agosto");
            console.log(datosMes)
            crearElementosOption(datosZona, "zona" ,divPrincipal, div);
            let zona = document.getElementById("zona");
            recorrerZonas(datosMes, zona);
           }
           else if (valorMes == "Septiembre"){
            div.innerHTML = "";
            datosMes = datosEmpleados.filter((dato) => dato.mes == "Septiembre");
            console.log(datosMes)
            crearElementosOption(datosZona, "zona" ,divPrincipal, div);
            let zona = document.getElementById("zona");
            recorrerZonas(datosMes, zona);
           }
           else if (valorMes == "Octubre"){
            div.innerHTML = "";
            datosMes = datosEmpleados.filter((dato) => dato.mes == "Octubre");
            console.log(datosMes)
            crearElementosOption(datosZona, "zona" ,divPrincipal, div);
            let zona = document.getElementById("zona");
            recorrerZonas(datosMes, zona);
           }
            else if (valorMes == "Noviembre"){
              div.innerHTML = "";
              datosMes = datosEmpleados.filter((dato) => dato.mes == "Noviembre");
              console.log(datosMes)
              crearElementosOption(datosZona, "zona" ,divPrincipal, div);
              let zona = document.getElementById("zona");
              recorrerZonas(datosMes, zona);
            }
            else if (valorMes == "Diciembre"){
              div.innerHTML = "";
              datosMes = datosEmpleados.filter((dato) => dato.mes == "Diciembre");
              console.log(datosMes)
              crearElementosOption(datosZona, "zona" ,divPrincipal, div);
              let zona = document.getElementById("zona");
              recorrerZonas(datosMes, zona);
            }




      })




   


        function crearCanva ( arregloControlesNombre , arregloControlesContador) {
          const ctx = document.getElementById('barra');
          if (grafico) {
            grafico.destroy();
          }
          grafico = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: arregloControlesNombre  ,
            datasets: [{
              label: 'Cantidad Tipo de control',
              data: arregloControlesContador, 
              borderWidth: 2,
            }]
          },  
          options: {  
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
            });
        }

        function crearTabla (datosMes,divTabla , espacioreflejar){
          // crear tabla

          console.log("Estoy en crear tabla")
          console.log(datosMes, "hey estos son los datos")

          console.log(divTabla, "hey este es el div")
          divTabla.innerHTML = "";
          if (datosMes.length > 0){
            
          let tabla = document.createElement("table");
          tabla.id = "tabla";
          tabla.className = "fl-table";
          let thead = document.createElement("thead");
          let tr = document.createElement("tr");
          let th1 = document.createElement("th");
          th1.innerHTML = "Sede";

          let th2 = document.createElement("th");
          th2.innerHTML = "Zona";
          let th3 = document.createElement("th");
          th3.innerHTML = "Subzona";
          let th4 = document.createElement("th");
          th4.innerHTML = "Tipo control";
          let th5 = document.createElement("th");
     
          th5.innerHTML = "Empleado";
          tr.appendChild(th1);
          tr.appendChild(th2);
          tr.appendChild(th3);
          tr.appendChild(th4);
          tr.appendChild(th5);
      
          thead.appendChild(tr);
          tabla.appendChild(thead);
          let tbody = document.createElement("tbody");
          for (let index = 0; index < datosMes.length; index++) {
            let tr = document.createElement("tr");
            let td1 = document.createElement("td");
            td1.innerHTML = datosMes[index].sede;
            let td2 = document.createElement("td");
            td2.innerHTML = datosMes[index].zona;
            let td3 = document.createElement("td");
            let datoSubzona ;
            let datosConrtrol;
            datosMes[index].control.forEach(datoActuaL => {
              if (datoActuaL.clave == espacioreflejar ){
                 datoSubzona = datoActuaL.clave;
                 datosConrtrol = datoActuaL.valor;
              }
            })
            td3.innerHTML = datoSubzona;
            let td4 = document.createElement("td");
            td4.innerHTML =datosConrtrol;
            let td5 = document.createElement("td");
           
            td5.innerHTML = datosMes[index].nombre;
            tr.appendChild(td1);
            tr.appendChild(td2);
            tr.appendChild(td3);
            tr.appendChild(td4);
            tr.appendChild(td5);
           
            tbody.appendChild(tr);
          }
          tabla.appendChild(tbody);
          divTabla.appendChild(tabla);
         
          


          }

        }

        function recorrerZonas (datosMes,zona){
          
        let arregloControlesContador= [0,0,0,0];
        let arregloControlesNombre = ['Limpieza', 'Desinfección', 'Higienización', 'Dotación'];

        // console.log(getArray[0])
        // var nombresEmpleados =  document.getElementById('mydiv').dataset.test
        // tomar select de la zona

        let resultado;
        // let div = document.getElementById("optionsContainer");
        let subtitulo = document.getElementById("subtitulo");
        let div2 = document.createElement("div");
            div2.id = "div2";
        let div3 = document.createElement("div");
            div3.id = "div3";
        let divTabla = document.getElementById("divTablaH");
     
           

          zona.addEventListener('change', (event) => {
          resultado = event.target.value;
          
          if (resultado == "nulo") {
            subtitulo.innerHTML = "No hay datos";
            if (grafico) {
              grafico.destroy();
            }
          }else  if (resultado == "Recepción") {
              subtitulo.innerHTML = "Estadísticas de la zona " + "Recepción";
              
            div2.innerHTML = ""; 
            var array = ["Selecciona una opción","Espacio Recepción", "Rectoria", "Dirección Administrativa", "Zona común"];
            crearElementosOption(array, resultado, div, div2);
            let select = document.querySelector('select[name="Recepción"]')
            
            select.addEventListener('change', (event) => {
              let resultado2 = event.target.value;
              
              if (resultado2 == "Espacio Recepción") {              
                subtitulo.innerHTML = "Estadísticas de la zona " + "Recepción" +" " + "Espacio Recepción";
                divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado2, datosMes, resultado, arregloControlesNombre, divTabla);
              }else if (resultado2 == "Rectoria") {
                subtitulo.innerHTML = "Estadísticas de la zona " + "Recepción" + " " + "Rectoria";
                divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado2, datosMes, resultado, arregloControlesNombre, divTabla);
              }else if (resultado2 == "Dirección Administrativa") {
                subtitulo.innerHTML = "Estadísticas de la zona " + "Recepción" + " " + "Dirección Administrativa";
                divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado2, datosMes, resultado, arregloControlesNombre, divTabla);
              }else if (resultado2 == "Zona común") {
                subtitulo.innerHTML = "Estadísticas de la zona " + "Recepción" + " " + "Zona común";
                divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado2, datosMes, resultado, arregloControlesNombre, divTabla);
              }
            }) 
                                 
          }else if (resultado == "Preescolar") {
            div2.innerHTML = ""; 
            subtitulo.innerHTML = "Estadísticas de la zona " + "Preescolar";
           
            var array = ["Selecciona una opción","Prejardin", "Jardín", "Transición", "Salón de aislamiento y desinfección"];
            
            crearElementosOption(array, resultado, div, div2);
            let select = document.querySelector('select[name="Preescolar"]')
            console.log(select, "este es el select")
            select.addEventListener('change', (event) => {
              let resultado2 = event.target.value;
              console.log(resultado2, "este es el resultado2")
              if (resultado2 == "Prejardin") {
                subtitulo.innerHTML = "Estadísticas de la zona " + "Preescolar" + " " + "Prejardin";
                divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado2, datosMes, resultado, arregloControlesNombre, divTabla);

              }else if (resultado2 == "Jardín") {
                subtitulo.innerHTML = "Estadísticas de la zona " + "Preescolar" + " " + "Jardín";
                divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado2, datosMes, resultado, arregloControlesNombre, divTabla);
              
              }else if (resultado2 == "Transición") {
                subtitulo.innerHTML = "Estadísticas de la zona " + "Preescolar" + " " + "Transición";
                divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado2, datosMes, resultado, arregloControlesNombre, divTabla);
              }else if (resultado2 == "Salón de aislamiento y desinfección") {
                subtitulo.innerHTML = "Estadísticas de la zona " + "Preescolar" + " " + "Salón de aislamiento y desinfección";
                divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado2, datosMes, resultado, arregloControlesNombre, divTabla);
              }
            })

          }else if (resultado == "ZonasComunesPre") {
            div2.innerHTML = ""; 
            subtitulo.innerHTML = "Estadísticas de la zona " + "Preescolar";
            var array = ["Selecciona una opción","Patio de juegos", "Escalera", "Baños"];
            crearElementosOption(array, resultado, div, div2);
            let select = document.querySelector('select[name="ZonasComunesPre"]')
            select.addEventListener('change', (event) => {
              let resultado2 = event.target.value;
              console.log(resultado2, "este es el resultado2")
              if (resultado2 == "Patio de juegos") {
                subtitulo.innerHTML = "Estadísticas de la zona " + "Preescolar" + " " + "Patio de juegos";
                divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado2, datosMes, resultado, arregloControlesNombre, divTabla);
              }else if (resultado2 == "Escalera") {
                subtitulo.innerHTML = "Estadísticas de la zona " + "Preescolar" + " " + "Escalera";
                divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado2, datosMes, resultado, arregloControlesNombre, divTabla);
              }else if (resultado2 == "Baños") {
                subtitulo.innerHTML = "Estadísticas de la zona " + "Preescolar" + " " + "Baños";
                divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado2, datosMes, resultado, arregloControlesNombre, divTabla);
              }
            })

          }else if (resultado == "Básicas") {
            div2.innerHTML = "";  
        
            subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas";
            var array = ["Selecciona una opción", "Patio", "Baños y escaleras", "Salones piso 2-3 primaria", "Zona adminitrativa piso 2", "Salones piso 3-4 Bachillerato", "Laboratorios", "Cocina y escalera"];
            crearElementosOption(array, resultado, div, div2);
            let select = document.querySelector('select[name="Básicas"]')
            console.log(select, "este es el select")
            select.addEventListener('change', (event) => {
              let resultado2 = event.target.value;
              console.log(resultado2, "este es el resultado2")
              if (resultado2 == "Selecciona una opción") {
                subtitulo.innerHTML = "No hay datos";
              }else if (resultado2 == "Patio") {
                div3.innerHTML = "";
             
                subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Patio";
                var arregloZonaBasicasEscogida = ["Selecciona una opción","Patio Básicas", "Cooperativa", "Salón de aislamiento y desinfección", "SHUT"];
                crearElementosOption(arregloZonaBasicasEscogida, resultado2, div2, div3);
                console.log("hola", resultado2)
                
                let selectBasicas = div3.firstElementChild;
                console.log(selectBasicas, "este es el selectBasicas")
                selectBasicas.addEventListener('change', (event) => {
                  let resultado3 = event.target.value;
                  console.log(resultado3, "este es el resultado3")
                  if (resultado3 == "Selecciona una opción") {
                    subtitulo.innerHTML = "No hay datos";
                  }else if (resultado3 == "Patio Básicas") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Patio" + " " + "Patio Básicas";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Cooperativa") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Patio" + " " + "Cooperativa";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Salón de aislamiento y desinfección") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Patio" + " " + "Salón de aislamiento y desinfección";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "SHUT") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Patio" + " " + "SHUT";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }
                })
              }else if (resultado2 == "Baños y escaleras") {
                div3.innerHTML = "";
                subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Baños y escaleras";
                var arregloZonaBasicasEscogida =["Selecciona una opción","Escaleras piso 1-2", "Baños (piso 1.5)", "Escaleras piso 2-3", "Baños (piso 2.5)", "Escaleras piso 3-4", "Baños (piso 3.5)", "Escaleras piso 4-5", "Baños (piso 4.5)"];
                crearElementosOption(arregloZonaBasicasEscogida, resultado2, div2, div3);
                let selectBasicas = div3.firstElementChild;
                selectBasicas.addEventListener('change', (event) => {
                  let resultado3 = event.target.value;
                  console.log(resultado3, "este es el resultado3")
                  if (resultado3 == "Selecciona una opción") {
                    subtitulo.innerHTML = "No hay datos";
                  }else if (resultado3 == "Escaleras piso 1-2") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Baños y escaleras" + " " + "Escaleras piso 1-2";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Baños (piso 1.5)") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Baños y escaleras" + " " + "Baños (piso 1.5)";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Escaleras piso 2-3") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Baños y escaleras" + " " + "Escaleras piso 2-3";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Baños (piso 2.5)") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Baños y escaleras" + " " + "Baños (piso 2.5)";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Escaleras piso 3-4") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Baños y escaleras" + " " + "Escaleras piso 3-4";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Baños (piso 3.5)") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Baños y escaleras" + " " + "Baños (piso 3.5)";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Escaleras piso 4-5") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Baños y escaleras" + " " + "Escaleras piso 4-5";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Baños (piso 4.5)") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Baños y escaleras" + " " + "Baños (piso 4.5)";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }
                })
              }else if (resultado2 == "Salones piso 2-3 primaria") {
                div3.innerHTML = "";
                subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Salones piso 2-3 primaria";
                var arregloZonaBasicasEscogida = ["Selecciona una opción","Primero", "Segundo", "Tercero", "Cuarto", "Quinto"];
                crearElementosOption(arregloZonaBasicasEscogida, resultado2, div2, div3);
                let selectBasicas = div3.firstElementChild;
                selectBasicas.addEventListener('change', (event) => {
                  let resultado3 = event.target.value;
                  console.log(resultado3, "este es el resultado3")
                  if (resultado3 == "Selecciona una opción") {
                    subtitulo.innerHTML = "No hay datos";
                  }else if (resultado3 == "Primero") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Salones piso 2-3 primaria" + " " + "Primero";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Segundo") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Salones piso 2-3 primaria" + " " + "Segundo";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Tercero") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Salones piso 2-3 primaria" + " " + "Tercero";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Cuarto") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Salones piso 2-3 primaria" + " " + "Cuarto";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Quinto") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Salones piso 2-3 primaria" + " " + "Quinto";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }
                })

              }else if (resultado2 == "Zona adminitrativa piso 2") {
                div3.innerHTML = "";
                subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Zona adminitrativa piso 2";
                var arregloZonaBasicasEscogida = ["Selecciona una opción","Oficina coordinador 1", "Oficina coordinador 2", "Enfermería", "Zona común coordinación", "Psicología", "Sala de profesores"];
                crearElementosOption(arregloZonaBasicasEscogida, resultado2, div2, div3); 
                let selectBasicas = div3.firstElementChild;
                selectBasicas.addEventListener('change', (event) => {
                  let resultado3 = event.target.value;
                  console.log(resultado3, "este es el resultado3")
                  if (resultado3 == "Selecciona una opción") {
                    subtitulo.innerHTML = "No hay datos";
                  }else if (resultado3 == "Oficina coordinador 1") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Zona adminitrativa piso 2" + " " + "Oficina coordinador 1";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Oficina coordinador 2") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Zona adminitrativa piso 2" + " " + "Oficina coordinador 2";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Enfermería") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Zona adminitrativa piso 2" + " " + "Enfermería";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Zona común coordinación") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Zona adminitrativa piso 2" + " " + "Zona común coordinación";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Psicología") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Zona adminitrativa piso 2" + " " + "Psicología";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Sala de profesores") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Zona adminitrativa piso 2" + " " + "Sala de profesores";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }
                })  

              
              }else if (resultado2 == "Salones piso 3-4 Bachillerato") {
                div3.innerHTML = "";
                subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Salones piso 3-4 Bachillerato";
                var arregloZonaBasicasEscogida = ["Selecciona una opción","Sexto", "Séptimo", "octavo", "Noveno", "Décimo", "Once"];
                crearElementosOption(arregloZonaBasicasEscogida, resultado2, div2, div3);
                let selectBasicas = div3.firstElementChild;
                selectBasicas.addEventListener('change', (event) => {
                  let resultado3 = event.target.value;
                  console.log(resultado3, "este es el resultado3")
                  if (resultado3 == "Selecciona una opción") {
                    subtitulo.innerHTML = "No hay datos";
                  }else if (resultado3 == "Sexto") {
          
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Salones piso 3-4 Bachillerato" + " " + "Sexto";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Séptimo") {
              
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Salones piso 3-4 Bachillerato" + " " + "Séptimo";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Octavo") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Salones piso 3-4 Bachillerato" + " " + "Octavo";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Noveno") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Salones piso 3-4 Bachillerato" + " " + "Noveno";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Décimo") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Salones piso 3-4 Bachillerato" + " " + "Décimo";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Once") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Salones piso 3-4 Bachillerato" + " " + "Once";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }
                })

              }else if (resultado2 == "Laboratorios") {
                div3.innerHTML = "";
                subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Laboratorios";
                var arregloZonaBasicasEscogida = ["Selecciona una opción","Sala de Informática", "Laboratorios de Ciencia", "Comedor"];
                crearElementosOption(arregloZonaBasicasEscogida, resultado2, div2, div3);
                let selectBasicas = div3.firstElementChild;
                selectBasicas.addEventListener('change', (event) => {
                  let resultado3 = event.target.value;
                  console.log(resultado3, "este es el resultado3")
                  if (resultado3 == "Selecciona una opción") {
                    subtitulo.innerHTML = "No hay datos";
                  }else if (resultado3 == "Sala de Informática") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Laboratorios" + " " + "Sala de Informática";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Laboratorios de Ciencia") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Laboratorios" + " " + "Laboratorios de Ciencia";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Comedor") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Laboratorios" + " " + "Comedor";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }
                })

              }else if (resultado2 == "Cocina y escalera") {
                div3.innerHTML = "";
                subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Cocina y escalera";
                var arregloZonaBasicasEscogida = ["Selecciona una opción","Escalera piso 5-6", "Cocina"];
                crearElementosOption(arregloZonaBasicasEscogida, resultado2, div2, div3);
                let selectBasicas = div3.firstElementChild; 
                selectBasicas.addEventListener('change', (event) => {
                  let resultado3 = event.target.value;
                  console.log(resultado3, "este es el resultado3")
                  if (resultado3 == "Selecciona una opción") {
                    subtitulo.innerHTML = "No hay datos";
                  }else if (resultado3 == "Escalera piso 5-6") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Cocina y escalera" + " " + "Escalera piso 5-6";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }else if (resultado3 == "Cocina") {
                    subtitulo.innerHTML = "Estadísticas de la zona " + "Básicas" + " " + "Cocina y escalera" + " " + "Cocina";
                    divTabla.innerHTML = "";
                realizarArregloTipoControl(resultado3, datosMes, resultado, arregloControlesNombre, divTabla);
                  }
                })
              }
            })

          } 

          
          })
        }

        function crearElementosOption(array, zona, div, divBasicas) {
          let select = document.createElement("select");
          select.id = zona;
          select.name = zona;
          for (var i = 0; i < array.length; i++) {
              var option = document.createElement("option");


              option.id = array[i];
              option.value = array[i];  
              option.text = array[i];
              select.appendChild(option);
          }
          divBasicas.appendChild(select);
          div.appendChild(divBasicas);
          };

          function realizarArregloTipoControl (resultado2, datosEmpleados, resultado, arregloControlesNombre , divTabla){
            console.log("Aqui estoy" , datosEmpleados)
            let arregloControlesContador= [0,0,0,0];
            let arregloDatos = [];
            
                datosEmpleados.forEach(element => {
                  
                  if (element.zona == resultado ){
                  
                    element.control.forEach(tipo => {
                    
                    if(tipo.clave == resultado2){
                      console.log(element, "este es el elemento que quiero")
                      arregloDatos.push(element)
                      if (!Array.isArray(tipo.valor)) {
                          
                        if (tipo.valor == "Limpieza") {
                          arregloControlesContador[0] += 1;
                        }else if (tipo.valor == "Desinfección") {
                          arregloControlesContador[1] += 1;
                        }else if (tipo.valor == "Higienización") {
                          arregloControlesContador[2] += 1;
                        }else if (tipo.valor == "Dotación") {
                          arregloControlesContador[3] += 1;
                        }
                        console.log(arregloControlesContador, "este es el arreglo")
                       }else {

                        tipo.valor.forEach(element => {
                          if (element == "Limpieza") {
                            arregloControlesContador[0] += 1;
                          }else if (element == "Desinfección") {
                            arregloControlesContador[1] += 1;
                          }else if (element == "Higienización") {
                            arregloControlesContador[2] += 1;
                          }else if (element == "Dotación") {
                            arregloControlesContador[3] += 1;
                          }
                        });
                        console.log(arregloControlesContador, "este es el arreglo")
                      }
                      console.log(arregloDatos, "este es el arreglo de datos que se envia")
                      // arregloDatos.forEach(element => { 

                      //   console.log(element, "este es el elemento actual")
                      //   element.control.forEach(controlA => {
                      //     console.log(controlA, "este es el control actual")
                      //     if (controlA.clave != resultado2) {
                      //       console.log(controlA, "este es el control que se va a eliminar")
                      //       element.control.splice(element.control.indexOf(controlA), 1);
                      //     }
                      //   })

                      // });
                      // console.log(arregloDatos, "este es el arreglo de datos que se envia")
                      crearTabla(arregloDatos,divTabla , resultado2)
                    }
                    })
                    
                  }

              });
              crearCanva (arregloControlesNombre, arregloControlesContador);
              
              
          }
       
    </script>
    
</body>
</html>